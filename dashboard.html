<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Inventory Management System</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/dashboard.css?v=2">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon">üì¶</div>
                <div class="logo-text">Inventory</div>
            </div>

            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item active">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="products.html" class="nav-item">
                    <span class="nav-icon">üì¶</span>
                    <span class="nav-text">Products</span>
                </a>
                <a href="#" class="nav-item">
                    <span class="nav-icon">üè∑Ô∏è</span>
                    <span class="nav-text">Categories</span>
                </a>
                <a href="#" class="nav-item">
                    <span class="nav-icon">üöö</span>
                    <span class="nav-text">Suppliers</span>
                </a>
                <a href="#" class="nav-item">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">Orders</span>
                </a>
                <a href="#" class="nav-item">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Users</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Admin User</div>
                        <div class="user-role" id="userRole">Administrator</div>
                    </div>
                </div>
                <a href="login.html" class="logout-btn" onclick="logout()">
                    <span class="nav-icon">üö™</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h1 class="page-title">Dashboard Overview</h1>
                <div class="date-display" id="currentDate">December 4, 2025</div>
            </header>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon icon-blue">üì¶</div>
                    <div class="stat-details">
                        <div class="stat-value" id="totalProducts">0</div>
                        <div class="stat-label">Total Products</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-green">üí∞</div>
                    <div class="stat-details">
                        <div class="stat-value" id="inventoryValue">$0.00</div>
                        <div class="stat-label">Total Value</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-red">‚ö†Ô∏è</div>
                    <div class="stat-details">
                        <div class="stat-value" id="lowStockCount">0</div>
                        <div class="stat-label">Low Stock Items</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-purple">üè∑Ô∏è</div>
                    <div class="stat-details">
                        <div class="stat-value" id="totalCategories">0</div>
                        <div class="stat-label">Categories</div>
                    </div>
                </div>
            </div>

            <!-- Low Stock Alert Section -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">‚ö†Ô∏è Low Stock Alerts</h2>
                    <a href="products.html" class="btn btn-sm btn-outline">View All</a>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>SKU</th>
                                <th>Category</th>
                                <th>Stock</th>
                                <th>Reorder Level</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="lowStockBody">
                            <!-- Low stock items will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Products Section -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">üïí Recent Products</h2>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>SKU</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentProductsBody">
                            <!-- Recent products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Check authentication
        function checkAuth() {
            const user = localStorage.getItem('currentUser');
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            const userData = JSON.parse(user);
            document.getElementById('userName').textContent = userData.name;
            document.getElementById('userRole').textContent = userData.role.charAt(0).toUpperCase() + userData.role.slice(1);
            document.getElementById('userAvatar').textContent = userData.name.charAt(0);
        }

        // Logout function
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        // Load dashboard data
        function loadDashboardData() {
            try {
                // Get products from localStorage
                const products = JSON.parse(localStorage.getItem('products') || '[]');

                // Calculate stats
                const totalProducts = products.length;
                const totalValue = products.reduce((sum, p) => sum + (p.unitPrice * p.quantityInStock), 0);
                const lowStockCount = products.filter(p => p.quantityInStock <= p.reorderLevel).length;

                // Update UI
                document.getElementById('totalProducts').textContent = totalProducts;
                document.getElementById('inventoryValue').textContent = '$' + totalValue.toLocaleString('en-US', { minimumFractionDigits: 2 });
                document.getElementById('lowStockCount').textContent = lowStockCount;
                document.getElementById('totalCategories').textContent = '4'; // Mock value

                // Display low stock products
                const lowStockProducts = products.filter(p => p.quantityInStock <= p.reorderLevel);
                displayLowStockProducts(lowStockProducts);

                // Display recent products (last 5)
                displayRecentProducts(products.slice(-5).reverse());

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showError('Failed to load dashboard data');
            }
        }

        // Display low stock products
        function displayLowStockProducts(products) {
            const tbody = document.getElementById('lowStockBody');

            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-state-icon">‚úÖ</div>
                            <div class="empty-state-title">All Good!</div>
                            <div class="empty-state-text">No products are currently low on stock</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = products.map(product => `
                <tr>
                    <td><strong>${product.name}</strong></td>
                    <td>${product.sku}</td>
                    <td>${product.categoryName || 'N/A'}</td>
                    <td><span class="badge badge-danger">${product.quantityInStock}</span></td>
                    <td>${product.reorderLevel}</td>
                    <td>
                        ${product.quantityInStock === 0
                    ? '<span class="badge badge-danger">Out of Stock</span>'
                    : '<span class="badge badge-warning">Low Stock</span>'}
                    </td>
                    <td>
                        <a href="products.html" class="btn btn-sm btn-primary">View</a>
                    </td>
                </tr>
            `).join('');
        }

        // Display recent products
        function displayRecentProducts(products) {
            const tbody = document.getElementById('recentProductsBody');

            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <div class="empty-state-icon">üì¶</div>
                            <div class="empty-state-title">No Products</div>
                            <div class="empty-state-text">Start by adding your first product</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = products.map(product => `
                <tr>
                    <td><strong>${product.name}</strong></td>
                    <td>${product.sku}</td>
                    <td>${product.categoryName || 'N/A'}</td>
                    <td>$${parseFloat(product.unitPrice).toFixed(2)}</td>
                    <td>${product.quantityInStock}</td>
                    <td>
                        ${product.quantityInStock === 0
                    ? '<span class="badge badge-danger">Out of Stock</span>'
                    : product.quantityInStock <= product.reorderLevel
                        ? '<span class="badge badge-warning">Low Stock</span>'
                        : '<span class="badge badge-success">In Stock</span>'}
                    </td>
                </tr>
            `).join('');
        }

        // Show error message
        function showError(message) {
            alert(message);
        }

        // Initialize dashboard
        window.addEventListener('load', () => {
            checkAuth();
            loadDashboardData();

            // Set current date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', options);
        });
    </script>
</body>

</html>